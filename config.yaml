# Working configuration for Multi-Agent Brain
# Chat API: https://api.metamirror.club/v1 with gemini-2.5-flash
# Embedding API: Local Ollama with qwen3-embedding:0.6b

network:
  name: "multi-agent-brain"
  mode: "centralized"
  node_id: "mab-local-dev"

  transports:
    - type: "http"
      config:
        host: "0.0.0.0"
        port: 8700
        cors:
          allow_origins:
            - "*"
    - type: "grpc"
      config:
        host: "0.0.0.0"
        port: 8600
        max_message_size: 104857600
        compression: "gzip"
        keepalive_time: 60000
        keepalive_timeout: 30000
        keepalive_permit_without_calls: false
        max_connection_idle: 300000
        max_connection_age: 1800000
        http2_max_pings_without_data: 0
        http2_min_time_between_pings: 60000
        http2_min_ping_interval_without_data: 300000

  manifest_transport: "http"
  recommended_transport: "grpc"

  encryption_enabled: false
  discovery_interval: 10
  discovery_enabled: true

  max_connections: 200
  connection_timeout: 30.0
  retry_attempts: 3
  heartbeat_interval: 60
  agent_timeout: 180

  message_queue_size: 1000
  message_timeout: 30.0
  message_routing_enabled: true

  mods:
    - name: "openagents.mods.workspace.messaging"
      enabled: true
      config:
        default_channels:
          - name: "general"
            description: "Public entry point for user questions"
          - name: "coordination"
            description: "Internal orchestration channel"
          - name: "python_expert"
            description: "Python specialist workspace"
          - name: "milvus_expert"
            description: "Vector database specialist workspace"
          - name: "devops_expert"
            description: "DevOps and infrastructure workspace"
        max_file_size: 10485760
        allowed_file_types:
          - "txt"
          - "md"
          - "py"
          - "json"
          - "yaml"
          - "pdf"
          - "jpg"
          - "png"
          - "csv"
        file_storage_path: "./workspace/uploads"
        file_retention_days: 60
        max_message_history: 10000
        message_retention_days: 90
        max_thread_depth: 10
        thread_collapse_threshold: 25

    - name: "openagents.mods.workspace.default"
      enabled: true
      config:
        workspace_type: "multi_agent_brain"
        workspace_path: "./workspace"
        auto_create_workspace: true

network_profile:
  discoverable: false
  name: "Multi-Agent Brain (Local)"
  description: "Local development network for the multi-agent brain demo"
  host: "127.0.0.1"
  port: 8700
  authentication:
    type: "none"
  tags:
    - "demo"
    - "multi-agent"
    - "development"
  categories:
    - "development"
    - "knowledge-base"
  required_openagents_version: "0.6.11"

log_level: "INFO"
data_dir: "./data/multi-agent-brain"
runtime_limit: null
shutdown_timeout: 30

# API Configuration
api_config:
  chat_api:
    provider: "custom"  # Using metamirror.club as custom provider
    model: "gemini-2.5-flash"
    timeout: 30
    max_retries: 3
    retry_delay: 1.0
    max_retry_delay: 60.0

  embedding_api:
    provider: "ollama"  # Local Ollama for embeddings
    model: "qwen3-embedding:0.6b"
    dimension: 768
    timeout: 30
    max_retries: 3
    retry_delay: 1.0
    max_retry_delay: 60.0

  browser_tool:
    enabled: true
    search_provider: "tavily"  # Primary provider: "tavily", "duckduckgo", "bing", "google"
    search_api_key: null  # Set via BROWSER_SEARCH_API_KEY or TAVILY_API_KEY env var
    fallback_provider: "duckduckgo"  # Fallback when primary fails
    browser_engine: "playwright"  # "playwright" or "none" to disable navigation
    headless: true
    search_timeout: 10
    navigation_timeout: 30
    max_retries: 3
    auto_browse_enabled: true  # Enable automatic browsing heuristics in CoordinationAgent
    persist_results: false  # Default: don't auto-persist to SharedMemory (explicit opt-in)

  agent_overrides:
    coordination:
      chat_model: "gemini-2.5-flash"
      embedding_model: "qwen3-embedding:0.6b"
      embedding_dimension: 768
      answer_verbose: false
    python_expert:
      chat_model: "gemini-2.5-flash"
      embedding_model: "qwen3-embedding:0.6b"
      embedding_dimension: 768
      answer_verbose: false
    milvus_expert:
      chat_model: "gemini-2.5-flash"
      embedding_model: "qwen3-embedding:0.6b"
      embedding_dimension: 768
      answer_verbose: false
    devops_expert:
      chat_model: "gemini-2.5-flash"
      embedding_model: "qwen3-embedding:0.6b"
      embedding_dimension: 768
      answer_verbose: false

registry:
  bootstrap:
    coordination:
      entrypoint: agents.coordination:CoordinationAgent
      layer: coordination
      expert_kind: coordination
      aliases:
        - router
        - orchestrator
      metadata:
        channel: coordination
    python_expert:
      entrypoint: agents.python_expert:PythonExpertAgent
      layer: expert
      expert_kind: python_expert
      aliases:
        - python
      metadata:
        channel: python_expert
    milvus_expert:
      entrypoint: agents.milvus_expert:MilvusExpertAgent
      layer: expert
      expert_kind: milvus_expert
      aliases:
        - milvus
      metadata:
        channel: milvus_expert
    devops_expert:
      entrypoint: agents.devops_expert:DevOpsExpertAgent
      layer: expert
      expert_kind: devops_expert
      aliases:
        - devops
      metadata:
        channel: devops_expert
    general:
      entrypoint: agents.general:GeneralAgent
      layer: entry
      expert_kind: general
      aliases:
        - lobby
      metadata:
        channel: general

prompts:
  base_path: "./prompts"
  coordination: null
  general: null
  python_expert: null
  milvus_expert: null
  devops_expert: null

channels:
  coordination:
    description: "Multi-agent coordination and orchestration"
    entrypoint: agents.coordination:CoordinationAgent
    visibility: internal
    targets:
      - python_expert
      - milvus_expert
      - devops_expert
      - general

  python_expert:
    description: "Python programming expert agent"
    entrypoint: agents.python_expert:PythonExpertAgent
    visibility: internal

  milvus_expert:
    description: "Milvus vector database expert agent"
    entrypoint: agents.milvus_expert:MilvusExpertAgent
    visibility: internal

  devops_expert:
    description: "DevOps and infrastructure expert agent"
    entrypoint: agents.devops_expert:DevOpsExpertAgent
    visibility: internal

  general:
    description: "General purpose agent for basic queries"
    entrypoint: agents.general:GeneralAgent
    visibility: public

routing:
  default_target: general
  escalations:
    coordination:
      - python_expert
      - milvus_expert
      - devops_expert

logging:
  level: "INFO"
  format: "{time:YYYY-MM-DD HH:mm:ss} | {level} | {name}:{function}:{line} | {message}"
  rotation: "100 MB"
  retention: "30 days"

performance:
  max_concurrent_requests: 10
  request_timeout: 60
  cache_size: 1000
  cache_ttl: 3600
